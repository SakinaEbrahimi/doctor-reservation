<%- include('../include/headUser.ejs')%>
<body class="index-page">
  
    <!-- header -->
    <%- include('../include/headerUser.ejs')%>
    <main class="main">        
        <section id="appointment" class="appointment section light-background">

    <!-- Section Title -->
    <div class="container section-title aos-init aos-animate" data-aos="fade-up">
      <h2>MAKE AN APPOINTMENT</h2>
      <!-- <p>Necessitatibus eius consequatur ex aliquid fuga eum quidem sint consectetur velit</p> -->
    </div><!-- End Section Title -->

    <div class="container aos-init aos-animate" data-aos="fade-up" data-aos-delay="100">

      <form action="/appointment" method="GET" role="form" class="php-email-form">
        
        <div class="row">  
          <div class="col-md-6 form-group mt-3">
            <select name="department" id="department" onchange="this.form.submit()"  class="form-select" required="">
              <option value="">Select Department</option>
              <% for(d of departmens){
                
                %>
              <option value="<%= d.id %>" <%= d.id === selectDpt ? 'selected' : ' ' %> > <%= d.dp %></option>
                <%
              } %>
            </select>
          </div>
          <div class="col-md-6 form-group mt-3">
            
              <select name="doctor" onchange="this.form.submit()" id="" class="form-select">
              <option value="">Select Doctor</option>
              <% for(doc of doctor){
                %>
                <option value="<%= doc.id %>" <%= doc.id === selectDoctor ? 'selected' : ' ' %> > <%= doc.name %></option>
                <%
              } %>
              </select>
          </div>
          
        </div>
      </form>
            
        <% if(selectDoctor){
          %>
      <form action="/reserve" method="POST" >
        <div class="row">     
          <div class="col-md-6 form-group mt-3" style="margin-left: 25%;">
            <% if(Array.isArray(dates) && dates.length>0){
                %>
                  <select name="date" class="form-select"> Select Date
                <%
                for(d of dates){
                  const date = new Date(d.date)
                  const day = date.getDate().toString().padStart(2, '0')
                  const month = date.getMonth().toString().padStart(2,'0')   
                  const year = date.getFullYear()  
                  const hour = date.getHours().toString().padStart(2,'0') 
                  let period = ''
                  if(hour >= 12){
                     period = "PM"
                  }
                  else{
                     period = "AM"
                  }
                  %>
                  <option value="<%= d.date%>"><%= day%>/<%= month%>/<%= year%> - <%= hour%> <%= period%></option>
                  <%
                }
                %>
                  </select>
                <%
              
            }%>
            <br>
            <input type="hidden" name="doctorId" value="<%= selectDoctor %>">
            <input type="hidden" name="departmentId" value="<%= selectDpt %>">
          </div>
          <br>
            <div class="col-md-4 form-group">
              <input type="text" name="patientName" class="form-control"  placeholder="Your Name" >
            </div>
            <div class="col-md-4 form-group mt-3 mt-md-0">
              <input type="text" class="form-control" name="patientEmail"  placeholder="Your Email" >
            </div>
            <div class="col-md-4 form-group mt-3 mt-md-0">
              <input type="text" class="form-control" name="patientPhone" placeholder="Your Phone" >
            </div>
          <div class="form-group mt-3">
            <textarea class="form-control" name="patientMessage" rows="5" placeholder="Message (Optional)"></textarea>
          </div>
          <div class="mt-3">
            <div class="text-center"><button type="submit">Make an Appointment</button></div>
          </div>
        </div>
      </form>
          <%
        } %>
                

    </div>

        </section>
    </main>

<%- include('../include/footeruser.ejs')%>